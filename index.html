<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Checkout Page</title>
  <style>
    /* Keep your styles here, omitted for brevity */
  </style>
</head>
<body>

  <h2>Product Checkout</h2>

  <p><strong>Product:</strong> <span id="productName">Loading...</span></p>
  <p><strong>Price:</strong> $<span id="productPrice">0</span></p>

  <form id="checkoutForm">
    <label>Full Name
      <input type="text" id="name" required />
    </label>
    <label>Email Address
      <input type="email" id="email" required />
    </label>
    <label>Phone Number
      <input type="text" id="phone" required />
    </label>

    <button type="button" class="btn crypto" onclick="pay('crypto')">Pay with Crypto</button>
    <button type="button" class="btn card" onclick="pay('card')">Pay with Card</button>
  </form>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const productName = decodeURIComponent(urlParams.get('name') || 'Unnamed Product');
    const productPrice = parseFloat(urlParams.get('price') || '0').toFixed(2);

    document.getElementById('productName').textContent = productName;
    document.getElementById('productPrice').textContent = productPrice;

    async function pay(method) {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();

      if (!name || !email || !phone) {
        alert('Please fill all fields.');
        return;
      }

      try {
        const res = await fetch('http://localhost:3000/api/checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            email,
            phone,
            product: productName,
            price: productPrice,
            method
          })
        });

        const data = await res.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          alert('Payment URL not received.');
          console.error(data);
        }

      } catch (err) {
        alert('Error during payment initiation.');
        console.error(err);
      }
    }
  </script>
</body>
</html>
